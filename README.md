目录

一、 参赛作品简介及完成情况说明	3
二、 技术方案及算法设计	3
DDPG算法	3
参数设计	5
交错并联BUCK电路	5
强化学习控制BUCK电路PID控制器方案	6
三、 作品展示与结果	6
仿真实验	7
GUI设计	12
四、 总结	16











一、参赛作品简介及完成情况说明
本项目采用深度强化学习算法实现交错并联Buck电路双环PID控制器的参数自动整定方案。在算法设计与训练方面，基于Simulink平台搭建了交错并联Buck电路仿真模型，成功用DDPG强化学习算法进行控制器参数优化。通过精心设计的训练脚本训练迭代，算法能够自主学习并输出最优PID控制参数，满足比赛要求的性能指标。
在交互界面开发方面，我们实现了可视化GUI系统，提供两大核心功能：一是支持直接加载预训练模型，可立即进行仿真实验并获取最优PID控制方案；二是提供手动训练模式，用户可通过操作按钮启动训练过程，并实时观察奖励值（Reward）的变化曲线。
目前项目完成情况良好： DDPG算法脚本已开发完成在Simulink环境中成功实现了交错Buck电路的闭环控制，输出电压稳定在12V目标值，多相均流效果已实现。GUI系统功能已实现，具备模型加载和训练控制能力。
二、技术方案及算法设计
DDPG算法介绍：
DDPG深度确定性策略梯度算法是一种模型无关的强化学习算法，属于Actor-Critic框架，并且同时利用了DQN的各种优点。
DDPG通过四个神经网络分别学习：
1.当前Actor网络
2.目标Actor网络：初始参数与当前Actor网络相同
3.当前Critic网络
4.目标Critic网络：初始参数与当前Critic网络相同

 Critic网络负责对动作的质量进行评估，进行Q值的估计，来进行对Actor网络的指导。其中Q值就表示了当前状态的预期回报值。
 Actor网络负责生成动作，使得输出能获得最高Q值的动作。
 
DDPG的目标网络采用软更新方法：目标网络并不直接按照当前网络的参数进行更新，而是采用软更新的方式。这是因为如果目标网络的参数更新过于频繁或剧烈，可能会导致训练过程不稳定，甚至无法收敛。软更新通过缓慢地将目标网络的参数向当前网络的参数靠拢，使得目标网络能够逐渐适应当前网络的变化，同时又能保持一定的稳定性，为训练提供较为稳定的目标值，从而有助于提高算法的收敛速度和性能。
DDPG采用一种经验回放机制，将交互环境中的经验（状态、动作、奖励、下一状态）存储起来，训练时从中随机采样，减少数据相关性和样本浪费。提升了深度强化学习的稳定性和样本效率。
DDPG的训练步骤大致如下：
[1]初始化当前和目标Actor网络，当前和目标Critic网络的参数，并设置各项训练参数。
[2]不断与环境进行交互，收集样本数据。数据以（状态、动作、奖励、下一个状态、结束标志）的形式被存储在样本池中。
[3]进行网络更新
3.1从样本池中采样一个批次的数据。
3.2根据贝尔曼方程与目标Actor网络和目标Critic网络来计算目标Q值。即将下一个状态传入目标Actor网络中计算目标动作；将目标动作与下一个动作输入到目标Critic网络中，经过折扣因子后与奖励函数算出的奖励值加和，得到目标Q值。

3.3将状态、动作传入当前Critic网络计算当前Critic网络的预测Q值。
3.4根据预测Q值与目标Q值，来计算Critic网络损失值。

3.5梯度最小化来更新当前Critic网络的参数，让预测Q值与目标Q值更接近。
3.6使用策略梯度方法来计算梯度度更新当前Actor网络参数。

3.7在该批次数据训练结束后，采用软更新来更新目标Critic网络和目标Actor网络的参数。

3.8循环直至所有数据训练完成。
参数设计：
DDPG网络：
1．  采样时间 Ts = 0.0005秒
2．  总仿真时间Tf = 0.001秒
3．  DDPG智能体参数：
训练轮数：100
每回合步数：20
算法的输出参数上下限：算法的输出是一个1*3的向量，每个参数分别表示电压环控制器的P,I和电流环控制器的P，在实验中
'LowerLimit', [150; 100; 0.001],
'UpperLimit', [5000; 1000; 0.08]
表示电压环控制器P的范围为150到5000，I的范围为100到1000，电流环P的范围为0.001到0.08，
这里电流环P的范围不选择从0开始，是算法在训练过程中，可能为了避免不稳定所带来的高额惩罚，可能会在训练过程中陷入局部最优，使得电流环控制器的输出一直为0的情况。
交错并联BUCK电路简介：
交错并联Buck变换器是一种将多个Buck变换器单元并联运行的拓扑结构，各相的开关驱动信号以固定的相位差交错触发。对于两相交错并联Buck变换器，两个Buck单元输入并联、输出并联，驱动信号相位错开180°（即360°/2）。这种交错技术可以实现降低总输出电流纹波，各相电感电流纹波相互抵消，总电流纹波显著减小。提高等效开关频率，输出电压纹波的频率变为开关频率的2倍，允许使用更小的滤波元件。各相分担总电流，减少单个器件的热应力。

两相交错并联Buck变换器的工作模态取决于占空比D。当 D < 0.5 时：两相开关信号没有重叠。当 D > 0.5 时：两相开关信号有重叠部分。
交错并联的核心优势是纹波减小。对于两相（N=2），总电感电流纹波与单相电感电流纹波的比值公式如下：
当 0 < D < 0.5 时：

当 0.5< D < 1 时：


电感电流纹波，计算公式为:


强化学习控制BUCK电路PID控制器方案：
对于Simulink中的控制任务，DDPG的优势在于它是一个​​能够直接从交互数据中自动学习出高性能、平滑、连续控制策略的强大框架。它适合那些系统模型复杂、非线性强、传统控制方法难以整定或性能达不到要求的场景。
PID控制参数整定是一个连续动作空间问题，微调参数是连续的变化。DDPG相较于其他的强化学习算法的优势在于其可以实现直接处理连续的动作空间，DDPG的行动者网络直接输出一个确定的连续动作值，使得它能进行极其精细和平滑的参数优化，这是实现高性能控制的关键。
交错并联BUCK电路的控制器的电压环采用PI控制，电流环采用P控制，智能体Agent(即RL算法模块)会对这电压环的P和I参数与电流环的P参数进行控制，采用DDPG算法不断迭代寻找最优的控制器参数方案，并且在同一轮仿真运行的过程中，控制器的参数会动态的调整，能够改变用户在人工调参时，控制器参数无法改变的弊端，在训练后将模型保存，之后可以直接加载模型文件，从而便利用户的控制器设计过程。
三、作品展示与结果

图 2 DDPG自整定交错BUCK电路PID参数仿真
仿真实验：
该仿真采用SIMULINK与MATLAB2024b实现，分为DDPG算法，控制与交错BUCK电路三个部分。
DDPG算法部分：
DDPG算法部分由Agent部分，奖励函数，环境获取与结束条件三个模块，分别对应DDPG算法所需要的奖励Reward计算，环境获取与提前截止的需要。
Agent部分设计如下：
Critic网络将动作路径和状态路径进行拼接与融合实现，其中状态路径要比动作路径多一层，这是由于电路控制中的电压电流状态要比PID参数的动作输出复杂的多。
状态路径由4层全连接网络组成：
输入层：6维状态
全连接层1+RELU：将特征拓展至256维
全连接层2+RELU：将特征压缩至128维
全连接层3+RELU：将特征压缩至64维
全连接层4：输出32维状态特征
动作路径由3层全连接网络组成：
输入层：3维动作
全连接层1+RELU：将特征拓展至128维
全连接层2+RELU：将特征压缩至64维
全连接层3：输出32维状态特征
融合层：
拼接+RELU：将32维的状态特征和32维的动作特征拼接
全连接层1+RELU：将特征至64维
全连接层2+RELU：将特征压缩至32维
全连接层3+RELU：将特征压缩至16维
全连接层4：输出1维，也就是Q值

Actor网络将6维状态空间映射到3维PID参数空间，采用了5层网络的全连接。
输入层：6维状态
全连接层1+RELU：将特征拓展至256维
全连接层2+RELU：将特征压缩至128维
全连接层3+RELU：将特征压缩至64维
全连接层3+RELU：将特征压缩至32维
输出层：输出3维，也就是选择的动作

奖励函数的设计如下：
其中，根据比赛要求：电压2000W，电压12V，实现均流效果。奖励函数由电压跟随项，电流跟随项，电流平衡惩罚，相位控制惩罚与电压目标奖励组成

相位目标值：
                
奖励函数采用了以上的多个分量来同时实现多个跟踪目标，并且设计权重引导智能体向增大奖励方向优化。
在电压值接近于目标值时，采用了目标引导的阶梯奖励，当电压的误差减小时采用奖励的方式，避免训练后期奖励不足的情况，提升工程精度需求。
此外，为了保护硬件设备，还在奖励函数中设计了安全检查，当在第一次奖励计算的时刻，电压值超过15V或低于5V，或者两相电流中有一相大于100A时，立刻停止实验，并且返回大惩罚值。
环境获取部分：
环境获取模块：
该模块会将当前电压，第一相电流的瞬时值和直流量，第二相电流的瞬时值和直流量，两相电流的相位差作为环境值传入Agent。
交错BUCK电路模块：
该部分按照比赛的要求与交错BUCK电路的原理，进行电路的仿真。
软启动方案：
在交错BUCK电路实验中，当输入端施加一个较高的直流电压，而输出电容两端初始电压为 0V时，若直接采用最终目标输出电压计算得到的稳态占空比进行驱动，将导致严重的启动问题。由于输出电压无法突变，在开关管导通的瞬间，整个输入电压 将几乎全部施加在功率电感两端。这将产生极高的电流变化率，导致电感电流和输入电流出现巨大的冲击尖峰，从而导致器件过流烧毁，因此采用软起动方案。


四、总结
采用DDPG算法来进行交错并联BUCK电路的电流环和电压环控制器的参数控制设计，实现了电压控制到12V的比赛目标，功率2000W的目标。通过MATLAB仿真实验成功验证了其可行性，并且实现了GUI界面的设计，令使用者能够方便的设计新的奖励函数，进行训练和仿真。
